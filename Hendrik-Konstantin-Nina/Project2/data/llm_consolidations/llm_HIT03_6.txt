The issue seems to be with the handling of the pos variable, which is being incremented incorrectly, possibly causing it to exceed the length of the input string. Specifically, on line 95, pos is being updated in such a way that it can become larger than the string length, leading to a StringIndexOutOfBoundsException. This is particularly problematic with surrogate pairs or Unicode characters requiring multiple bytes. The key areas to check are how pos is updated in the loop (lines 89, 95) and whether the code correctly handles the limits of the input string, particularly for characters that take more than one byte in UTF-16 encoding.